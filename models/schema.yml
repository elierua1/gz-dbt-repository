 # schema.yml

 version: 2

 sources: 
   - name: raw
     schema: gz_raw_data
     tables:
       - name: sales
         identifier: raw_gz_sales
         description: sales of Greenweez / we have one row per product_id found in each orders_id

        # Freshness testing - make sure to fill in the ...
         loaded_at_field: "CAST(date_date AS TIMESTAMP)"
         freshness:
           warn_after: {count: 90, period: day}

         columns:
           - name: date_date 
             description: date of purchase
           - name: orders_id
             description: id of the order
           - name: pdt_id
             description: id of the product inside a specific order
           - name: revenue
             description: the revenue generated by the product
           - name: quantity
             description: quantity of a specific product inside the order
         tests:
           - unique:
              column_name: "(orders_id || '-' || pdt_id)"
       - name: product
         identifier: raw_gz_product
         description: information about the products, one row per product
         columns:
           - name: products_id 
             description: id of the product
             tests:
               - unique
               - not_null
           - name: purchse_price
             description: price of the product
       - name: ship
         identifier: raw_gz_ship
         description: Shipping information of the orders / we have one row per order_id 
         columns:
           - name: orders_id 
             description: id of the order
             tests:
               - unique
               - not_null
           - name: shipping_fee
             description: the price of shipping for each order
           - name: log_cost
             description: the cost of logistics for each order
           - name: ship_cost
             description: the cost of shipping for each order
       - name: adwords
         identifier: raw_gz_adwords
         description: the campaigns report for operation from Adwords 
         columns:
           - name: date_date 
             description: date of the campaign
           - name: paid_source
             description: source of the campaign
           - name: campaign_key
             description: the id of the campaign
           - name: camPGN_name
             description: name of the campaign
           - name: ads_cost
             description: cost of the campaign
           - name: impression
             description: impression of the campaign
           - name: click
             description: clicks of the campaign
         tests:
           - unique:
              column_name: "(date_date || '-' || campaign_key)"
       - name: bing
         identifier: raw_gz_bing
         description: the campaigns report for operation from Bing
         columns:
           - name: date_date 
             description: date of the campaign
           - name: paid_source
             description: source of the campaign
           - name: campaign_key
             description: the id of the campaign
           - name: camPGN_name
             description: name of the campaign
           - name: ads_cost
             description: cost of the campaign
           - name: impression
             description: impression of the campaign
           - name: click
             description: clicks of the campaign
         tests:
           - unique:
              column_name: "(date_date || '-' || campaign_key)"
       - name: criteo
         identifier: raw_gz_criteo
         description: the campaigns report for operation from Criteo
         columns:
           - name: date_date 
             description: date of the campaign
           - name: paid_source
             description: source of the campaign
           - name: campaign_key
             description: the id of the campaign
           - name: camPGN_name
             description: name of the campaign
           - name: ads_cost
             description: cost of the campaign
           - name: impression
             description: impression of the campaign
           - name: click
             description: clicks of the campaign
         tests:
           - unique:
              column_name: "(date_date || '-' || campaign_key)"
       - name: facebook
         identifier: raw_gz_facebook
         description: the campaigns report for operation from Facebook
         columns:
           - name: date_date 
             description: date of the campaign
           - name: paid_source
             description: source of the campaign
           - name: campaign_key
             description: the id of the campaign
           - name: camPGN_name
             description: name of the campaign
           - name: ads_cost
             description: cost of the campaign
           - name: impression
             description: impression of the campaign
           - name: click
             description: clicks of the campaign
         tests:
           - unique:
              column_name: "(date_date || '-' || campaign_key)"

# Intermediate tables

 models:
   - name: int_sales_margin
     description: the detail view of the all sales products ordered / one row per product
     columns:
       - name: date_date
         description: the date of the order
       - name: orders_id
         description: the id of the order
       - name: products_id
         description: the id of the product
       - name: revenue
         description: the revenue generated by the product
         tests:
           - not_null
       - name: quantity
         description: the quantity of products puchased
         tests:
           - not_null
       - name: purchase_cost
         description: the purchase cost of the product
         tests:
           - not_null
       - name: margin
         description: the margin generated by the product
         tests:
           - not_null
     tests:
        - unique:
           column_name: "(orders_id || '-' || product_id)"

   - name: int_orders_margin
     description: the detail view of the order's margin per day / one row per order id / all products aggregated
     columns:
       - name: orders_id
         description: the id of the order
         tests:
           - unique
           - not_null
       - name: date_date
         description: the date of the order
       - name: revenue
         description: the revenue generated by the order
         tests:
           - not_null
       - name: quantity
         description: the quantity of products inside the order
         tests:
           - not_null
       - name: purchase_cost
         description: the purchase cost of the order
         tests:
           - not_null
       - name: margin
         description: the margin generated by the order
         tests:
           - not_null

   - name: int_orders_operational
     description: the detail view of the order's operational margin per day / one row per order id / all products aggregated
     columns:
       - name: orders_id
         description: the id of the order
         tests:
           - unique
           - not_null
       - name: date_date
         description: the date of the order
       - name: margin
         description: the margin generated by the order
       - name: operational_margin
         description: the operational margin generated by the order / margin + shipping cost - log cost - ship cost
       - name: quantity
         description: the quantity of products inside the order
       - name: revenue
         description: the revenue generated by the order
       - name: purchase_cost
         description: the purchase cost of the order
       - name: shipping_fee
         description: the shipping fee applied the to order
       - name: ship_cost
         description: the shipping cost of the order
       - name: logcost
         description: the logistics cost of the order

# Mart

   - name: finance_days
     description: the detail financial view of the sales generated by the order / organised by day
     columns:
       - name: date_date
         description: date of the orders
         tests:
           - unique
           - not_null
       - name: nb_transaction
         description: the number of products sold for this date
         tests:
           - not_null
       - name: revenue
         description: the total revenue generated by the orders
         tests:
           - not_null
       - name: average_basket
         description: the average basket of the orders
         tests:
           - not_null
       - name: margin
         description: the total margin of the orders
         tests:
           - not_null
       - name: operational_margin
         description: the total operational margin generated by the orders
         tests:
           - not_null
       - name: total_purchase_cost
         description: the total purchase cost of the orders
         tests:
           - not_null
       - name: total_shipping_fees
         description: the total shipping fees applied the to orders
         tests:
           - not_null
       - name: total_ship_costs
         description: the shipping cost of the orders
         tests:
           - not_null
       - name: total_log_costs
         description: the logistics cost of the orders
         tests:
           - not_null
       - name: total_quantity_sold
         description: the quantity of products sold
         tests:
           - not_null
